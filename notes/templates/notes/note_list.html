{% extends 'notes/base.html' %}

{% block title %}–ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>
        {% if user.is_staff or user.is_superuser %}
            –í—Å–µ –∑–∞–º–µ—Ç–∫–∏ (–∞–¥–º–∏–Ω)
        {% else %}
            –ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏
        {% endif %}
    </h1>
    <a href="{% url 'note_create' %}" class="btn btn-primary">+ –°–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É</a>
</div>

<!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏) -->
<div class="alert alert-info">
    <strong>–û—Ç–ª–∞–¥–∫–∞:</strong>
    <ul>
        <li>–í—Å–µ–≥–æ –∑–∞–º–µ—Ç–æ–∫: {{ notes.count }}</li>
        <li>–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å: "{{ search_query }}"</li>
        <li>–¢–µ–≥–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ: {{ all_tags.count }}</li>
        {% if all_tags %}
            <li>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–≥–∏:
                {% for tag in all_tags %}
                    <span class="badge bg-secondary">{{ tag.name }}</span>
                {% endfor %}
            </li>
        {% endif %}
    </ul>
</div>

<!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-2">
            <div class="col-md-10">
                <input type="text"
                       name="query"
                       value="{{ search_query }}"
                       placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ (—Ç–µ–≥, –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ —Ç–µ–∫—Å—Ç)"
                       class="form-control">
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">üîç –ù–∞–π—Ç–∏</button>
            </div>
        </form>

        <!-- –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ–≥–∏ -->
        {% if all_tags %}
        <div class="mt-3">
            <small class="text-muted">–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–≥–∞–º:</small><br>
            {% for tag in all_tags %}
                <a href="?query={{ tag.name }}" class="badge bg-info text-decoration-none me-1 mb-1">
                    {{ tag.name }}
                </a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>

{% if notes %}
    <div class="row">
        {% for note in notes %}
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title">{{ note.title }}</h5>
                    <p class="card-text">{{ note.content|truncatewords:20 }}</p>

                    <!-- –¢–µ–≥–∏ –∑–∞–º–µ—Ç–∫–∏ —Å –æ—Ç–ª–∞–¥–∫–æ–π -->
                    <div class="mb-2">
                        <small class="text-muted">–¢–µ–≥–∏ —ç—Ç–æ–π –∑–∞–º–µ—Ç–∫–∏:</small><br>
                        {% if note.tags.all %}
                            {% for tag in note.tags.all %}
                                <span class="badge bg-secondary me-1">{{ tag.name }}</span>
                            {% endfor %}
                        {% else %}
                            <span class="badge bg-light text-dark">–Ω–µ—Ç —Ç–µ–≥–æ–≤</span>
                        {% endif %}
                    </div>

                    {% if user.is_staff or user.is_superuser %}
                    <div class="mb-2">
                        <span class="badge bg-dark">üë§ {{ note.user.username }}</span>
                    </div>
                    {% endif %}

                    <div class="text-muted small">
                        –°–æ–∑–¥–∞–Ω–æ: {{ note.created_at|date:"d.m.Y H:i" }}
                    </div>
                </div>
                <div class="card-footer">
                    <a href="{% url 'note_detail' note.pk %}" class="btn btn-sm btn-outline-primary">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a>
                    <a href="{% url 'note_edit' note.pk %}" class="btn btn-sm btn-outline-secondary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="alert alert-warning">
        {% if search_query %}
            –ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ search_query }}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.
            <a href="{% url 'note_list' %}" class="alert-link">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–º–µ—Ç–∫–∏</a>
        {% else %}
            –ó–∞–º–µ—Ç–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç. <a href="{% url 'note_create' %}" class="alert-link">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–º–µ—Ç–∫—É!</a>
        {% endif %}
    </div>
{% endif %}
{% endblock %}